import static groovy.io.FileType.*

def outputDir="/home/kirk/3d/scad"

def partMap = [
	'garbage_truck':	['trashPrint','trashCanTop'],
	'rail_plugs':	['m1','m2','m3'],
	'Aqee_customizable_toy_train_tracks':	['x'],
	'ballon_tie':	['default'],
	'rider':	['servo_mount','stepdown_mount','board_mount'],
	'reception_booth':	['road','barrier_post','barrier_post2','booth','barrier'],
	'vl53l0x-servo':	['fullMount','fullMount0'],
	'petrol_station':	['road','pump','roadPart'],
	'mini_c270_mod':	['foot','middle','cameraHolder'],
	'fiesta_2003_vent_mount':	['ventPart','allinone'],
	'shower_booth_handle':	['handleA','handleB','handleT'],
	'esp-gen-1-b':		['top', 'bottom'],
	'calib':		['push_in','circles','islands','matrioska'],
	'wheelNutDriver':	['def'],
	'drillHolder':		['def'],
	'puzzle_box_viktor':	['lid','base'],
	'toilet-holder':	['part0','part1','part2','joint'],
	'matchbox_container':	['print','door'],
	'magnastix-blocks':	['p4','p3','p6'],
	'filament_roll_end':	['def'],
	'nespresso-honeycomb':	['y1','y2','c1','c2'],
	'toilet-hanger':	['def'],
	'toilet-hanger-mizse':	['def'],
	'toilet-storage':	['base','lid','full'],
	'CarriageV3__AnetA8_E3Dv6_Mount_TNS': ['def'],
	'wooden_train_trailer_car':['def'],
	'smadapt':	['def'],
	'train_car':		['body','attach','wheel','bodyp','spacer'],
	'playdoh_tanka_extrusion_shapes':	['b0','rot3','spagetti','predator','lines','star','tube'],
	'battery_shell':	['def','block'],
	'hole_adapter':		['m44','m36'],
	'stand':		['stand'],
	'esp-gen-3':		['top', 'bottom'],
	'box_clip':		['def'],
	'dolce_gusto_piccolo_nonslip':	['def'],
	'hanger_cherry':	['def','fitting'],
	'rolo':			['print'],
	'thumbwheel':		['m3'],
	'basket_clamp':		['def'],
	'wire_clamp3':		['def'],
	'arduino_car':		['motor_mount','topPlate0','topPlate1','chassis'],
	'door_label':		['preview','full'],
	'dolce2fix':		['def'],
	'toy_cover_piece':	['def'],
	'letter':		['0123','4567','89'],
	'slippers_mount':	['def'],
	'baby_lock':		['89','91','70'],
	'baby_lock2':		['main','aux'],
	'baby_lock3':		['main'],
	'maximera_front_drill': ['main','addon','off5'],
	'can_cap':		['75500','86000','55000','54300','102000'],
	'dxf_car1':	['def'],
	'dxf_car2':	['def'],
	'geocaching_box1':	['holder','full','magnet-test','simple','hanger'],
//	'activity_board_1':	['def'],
//	'dimmer_bottom':	['def'],
//	'dimmer_top':		['def'],
	'box_wheel':		['frame','wheel','w1'],
	'bb_maoam_dispenser':	['cover','wheel','driveGear','driveGearCover'],
	'inserta_knock-in_drill':	['def','mount'],
	'axilo-scaffold': ['def'],
	'camar801': ['def'],
	'ikea_hanger': ['main','step','diff_marker'],
	'kitchen_handle_drill':	['def'],
	'run_light_case':['def'],
	'kinga_rajz_kulcst':['def'],
	'pir_hole_cover':['upper'],
	'Clips':['def'],
	'dxf_stuff':['car3','car4','car5','frozen1','frozen2','icecream','grass1','grass2','cherry1','cherry2','tree1','tree2','tree3','tree4','house1','house2','house3','people1','people2','people3','people4'],
	'sound16_mount':		['simple'],
	'mounts':		['rc522','sound16','hourglass','dingdong','dingdong2','keyb','speaker','digitboard','melodyboard','b22fix'],
	'run_light_case2':	['def'],
	'run_light_case3':	['def'],
	'penhold4_2017update':	['def'],
        'sofa_feet_plug':  ['plug','stand'],
	'climate_end': ['def','main'],
	'wire_guide':['5','8','10'],
//	'bathroom_shelf':['render'],
'drawing_shapes':['a6','a4','a3','a5','a360'],
'babytaxi_steering_wheel':['def','preview'],
	'filament_holder':['def'],
	'pipe_cup':['part'],
	'seat_switch':['l','r'],
	'hook':['def'],
	'kx':['def'],
	'lanyok_szoba':['print','radiator'],
	'gyerekszoba':['cab30','a30','b30','d30','table30','bed30'],
	'lanyok_bunkbed':['s30'],
	'spacers':['1000','2000','3000','4000','5000','6000','7000' ],
	'drill_spacers':['edge','ruler9','10to5','d8l1','d8l2','d8l3','edgeDrill3','edgeDrill3s'],
'angelcare_stand':['hook','clamp'],
'esp-box-angled-mount':['def'],
'bicycle_handle_ribbon':['def'],
'key_label':['Akácköz','Kaszás','JMF-947'],
		]

//new File('.').eachFileMatch FILES, ~/.*\.scad/, { File f ->
//	println f
//}

def projMap = [
	'lanyok_galeria':		['proj'],
	'matchbox_container':		['floor'],
	'esp-gen-3':			['project'],
//	'kitchen':			['mPiece', 'mFuszer', 'mFelso',
/*						'projtest','P-YZ_LI9','P-YZ_LI8','P-XY_U3','F-A_250','F-A_550',
						'P-YZ_LI5',
						'P-YZ_LI3',
						'P-YZ_LI2',
						'P-YZ_LI1',
						'P-YZ_RC1',
						'P-YZ_RC3',
						'P-XY_BF_1',
						'P-YZ_RX11U',
						'P-YZ_RX11L',
						'P-YZ_RX13L',
						],*/
	'inserta_knock-in_drill':	['project'],
	'lights':			['p0','p1','pr'],
	'lights2':			['main','kitchen'],
	'ikea_bridge':			['def'],
	'lanyok_bunkbed':		['proj',
		'P-BED_L-SBXZ',
		'P-BED_L-SFXZ',
		'P-L_SIDEXZ'],
	'ex':				['def'],
	]

task allScad() {}
task allPdf() {}
task allDxf() {}

partMap.each { inputName,modes ->
	modes.each { mode ->
		println "${inputName} ; ${mode}"
		def outputName="${inputName}@${mode}"
		def oFile=new File(outputDir,"${outputName}.stl")
		def t=task("scad_${outputName}",type:Exec) {
			def inputFile=file("${inputName}.scad")
			inputs.file inputFile
			outputs.file oFile
			environment('OPENSCADPATH','../libraries/')
			commandLine "openscad","-D","mode=\"$mode\"","-D","render=true","-o",oFile,inputFile
		}
		allScad.dependsOn(t)
	}
}

projMap.each { inputName,modes ->
	modes.each { mode ->
		println "${inputName} ; ${mode}"
		def outputName="${inputName}@${mode}"
		def sFile=new File(outputDir,"${outputName}.svg")
		def oFile=new File(outputDir,"${outputName}.pdf")
		def oFile2=new File(outputDir,"${outputName}.png")
		def t=task("scad_${outputName}",type:Exec) {
			def inputFile=file("${inputName}.scad")
			inputs.file inputFile
			outputs.file sFile
			commandLine "openscad","-D","mode=\"$mode\"","-o",sFile,inputFile
		}
		def t2=task("inkscape_${outputName}",type:Exec) {
			dependsOn t
			inputs.file sFile
			outputs.file oFile
			commandLine "inkscape","--without-gui","--export-pdf=$oFile",sFile
		}
		def t3=task("inkscape_${outputName}_png",type:Exec) {
			dependsOn t
			inputs.file sFile
			outputs.file oFile2
			commandLine "inkscape","--without-gui","--export-png=$oFile2",sFile
		}


		allScad.dependsOn(t2)
		allScad.dependsOn(t3)
		allPdf.dependsOn(t2)
		allPdf.dependsOn(t3)
//		allDxf.dependsOn(t3)
	}
}

