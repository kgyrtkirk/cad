import static groovy.io.FileType.*

def outputDir="/home/kirk/3d/scad"

def partMap = [
	'garbage_truck':	['trashPrint','trashCanTop'],
	'rail_plugs':	['m1','m2','m3'],
	'Aqee_customizable_toy_train_tracks':	['x'],
	'ballon_tie':	['default'],
	'rider':	['servo_mount','stepdown_mount','board_mount'],
	'reception_booth':	['road','barrier_post','barrier_post2','booth','barrier'],
	'vl53l0x-servo':	['fullMount','fullMount0'],
	'petrol_station':	['road','pump','roadPart'],
	'mini_c270_mod':	['foot','middle','cameraHolder'],
	'fiesta_2003_vent_mount':	['ventPart','allinone'],
	'shower_booth_handle':	['handleA','handleB','handleT'],
	'esp-gen-1-b':		['top', 'bottom'],
	'calib':		['push_in','circles','islands','matrioska'],
	'wheelNutDriver':	['def'],
	'drillHolder':		['def'],
	'puzzle_box_viktor':	['lid','base'],
	'toilet-holder':	['part0','part1','part2','joint'],
	'matchbox_container':	['print','door'],
	'magnastix-blocks':	['p4','p3','p6'],
	'filament_roll_end':	['def'],
	'nespresso-honeycomb':	['y1','y2','c1','c2'],
	'toilet-hanger':	['def'],
	'toilet-storage':	['base','lid','full'],
	'CarriageV3__AnetA8_E3Dv6_Mount_TNS': ['def'],
	'wooden_train_trailer_car':['def'],
	'smadapt':	['def'],
	'train_car':		['body','attach','wheel','bodyp','spacer'],
	'playdoh_tanka_extrusion_shapes':	['b0','rot3','spagetti','predator','lines','star','tube'],
	'battery_shell':	['def'],
	'hole_adapter':		['m44','m36'],
	'stand':		['stand'],
	'esp-gen-3':		['top', 'bottom'],
	'box_clip':		['def'],
	'dolce_gusto_piccolo_nonslip':	['def'],
	'hanger_cherry':	['def','fitting'],
	'rolo':			['print'],
	'thumbwheel':		['m3'],
	'basket_clamp':		['def'],
	'wire_clamp3':		['def'],
	'arduino_car':		['motor_mount','topPlate0','topPlate1','chassis'],
	'door_label':		['preview','full'],
	'dolce2fix':		['def'],
	'toy_cover_piece':	['def'],
	'letter':		['0123','4567','89'],
	'slippers_mount':	['def'],
	'baby_lock':		['89','91','70'],
	'baby_lock2':		['main','aux'],
	'baby_lock3':		['main'],
	'maximera_front_drill': ['main','addon'],
	'can_cap':		['75500','86000','54300','102000'],
	'dxf_car1':	['def'],
	'dxf_car2':	['def'],
	'geocaching_box1':	['holder','full','magnet-test','simple'],
	'activity_board_1':	['def'],
	'dimmer_bottom':	['def'],
	'dimmer_top':		['def'],
	'box_wheel':		['frame','wheel','w1'],
	'bb_maoam_dispenser':	['cover','wheel','driveGear','driveGearCover'],
		]

//new File('.').eachFileMatch FILES, ~/.*\.scad/, { File f ->
//	println f
//}

def projMap = [
	'matchbox_container':	['floor'],
	'esp-gen-3':		['project'],
	'kitchen':		['p1'],
	]

task allScad() {}
task allPdf() {}

partMap.each { inputName,modes ->
	modes.each { mode ->
		println "${inputName} ; ${mode}"
		def outputName="${inputName}@${mode}"
		def oFile=new File(outputDir,"${outputName}.stl")
		def t=task("scad_${outputName}",type:Exec) {
			def inputFile=file("${inputName}.scad")
			inputs.file inputFile
			outputs.file oFile
			environment('OPENSCADPATH','../libraries/')
			commandLine "openscad","-D","mode=\"$mode\"","-D","render=true","-o",oFile,inputFile
		}
		allScad.dependsOn(t)
	}
}

projMap.each { inputName,modes ->
	modes.each { mode ->
		println "${inputName} ; ${mode}"
		def outputName="${inputName}@${mode}"
		def sFile=new File(outputDir,"${outputName}.svg")
		def oFile=new File(outputDir,"${outputName}.pdf")
		def t=task("scad_${outputName}",type:Exec) {
			def inputFile=file("${inputName}.scad")
			inputs.file inputFile
			outputs.file sFile
			commandLine "openscad","-D","mode=\"$mode\"","-o",sFile,inputFile
		}
		def t2=task("inkscape_${outputName}",type:Exec) {
			dependsOn t
			inputs.file sFile
			outputs.file oFile
			commandLine "inkscape","--without-gui","--export-pdf=$oFile",sFile
		}

		allScad.dependsOn(t2)
		allPdf.dependsOn(t2)
	}
}

